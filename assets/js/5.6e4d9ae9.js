(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{55:function(e,t,n){"use strict";n.r(t);var o=n(0),a=Object(o.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"原生js实现粘贴到剪贴板"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#原生js实现粘贴到剪贴板","aria-hidden":"true"}},[e._v("#")]),e._v(" 原生JS实现粘贴到剪贴板")]),n("p",[e._v("本文主要讨论原生方法，有时候项目一个小地方需要用到，直接上第三方库显得不够优雅")]),n("p",[e._v("目前常见的实现粘贴到剪贴板主要有以下两种方法：")]),n("ul",[n("li",[e._v("第三方库 "),n("a",{attrs:{href:"https://github.com/zenorocha/clipboard.js/",target:"_blank",rel:"noopener noreferrer"}},[e._v("clipboard")])]),n("li",[e._v("原生JS, 主要是 "),n("code",[e._v("document.execCommand")]),e._v("方法")])]),n("p",[e._v("第一种方法按照文档说明，设置触发元素的"),n("code",[e._v("data-clipboard-text")]),e._v(" 或者 "),n("code",[e._v("data-clipboard-target")]),e._v("即可，不做说明，"),n("a",{attrs:{href:"https://github.com/zenorocha/clipboard.js/",target:"_blank",rel:"noopener noreferrer"}},[e._v("详见文档")])]),n("p",[e._v("第二种方法：\n"),n("code",[e._v("document.execCommand")])]),n("p",[e._v("这个方法的兼容性其实不算很好，特别是移动端，具体"),n("a",{attrs:{href:"https://caniuse.com/#search=execCommand",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里")]),e._v("有, 但clipboard针对部分机型也有问题，所以具体使用还是得看情况， 因此使用该方法前检查浏览器是否支持很有必要"),n("code",[e._v("bool = document.execCommand('copy')")])]),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN")]),e._v("对上述方法的解释如下：")]),n("blockquote",[n("p",[e._v("当一个HTML文档切换到"),n("strong",[e._v("设计模式")]),e._v(" designMode时，文档对象暴露 execCommand 方法，该方法允许运行命令来操纵"),n("strong",[e._v("可编辑区域")]),e._v("的内容。")])]),n("p",[e._v("注意加粗部分，"),n("em",[e._v("设计模式")]),e._v(" ，即：使用前我们需切换文档模式为设计模式")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("document.designMode = 'on'\n")])]),n("p",[e._v("完成运行命令之后再设置值为"),n("code",[e._v("off")])]),n("p",[e._v("还有个加粗部分，"),n("em",[e._v("可编辑区域")]),e._v(" ，默认的input和textarea元素是可编辑(设置一个元素的"),n("code",[e._v('contenteditable="true"')]),e._v("也可激活元素的编辑模式)")]),n("p",[e._v("先来看表单元素如何实现")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("ele.addEventListener('click', () => {\n    document.designMode = 'on'\n    let bool = document.execCommand('copy')\n    if (!bool) {\n        alert('sorry, 手动复制吧')\n    } else {\n        let val = 'something'\n        let inputEle = document.createElement('input')\n        document.body.appendChild(inputEle)\n        inputEle.setAttribute('value', val)\n        inputEle.setAttribute('readonly', 'readonly')\n        inputEle.select()\n        document.execCommand('copy')\n        document.body.removeChild(inputEle)\n        alert('copied')\n    }\n    document.designMode = 'off'\n})\n")])]),n("p",[e._v("为避免出现光标或者拉起输入法，需要给元素设置"),n("code",[e._v("readonly")]),e._v("属性")]),n("p",[e._v("inputEle.select()方法在一些浏览器中有时不能选中所有内容，这时需要利用inputeElement的"),n("code",[e._v("setSelectionRange")]),e._v("方法：")]),n("blockquote",[n("p",[e._v("HTMLInputElement.setSelectionRange 方法可以从一个被 focused 的 input\n元素中选中特定范围的内容。")])]),n("p",[e._v("综上加两行：")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("...\ninputEle.focus()\ninputEle.setSelectionRange(0, inputEle.value.length)\ndocument.execCommand('copy')\n...\n")])]),n("p",[e._v("如果不是"),n("code",[e._v("input")]),e._v("等表单元素，不能使用"),n("code",[e._v("select")]),e._v("和"),n("code",[e._v("setSelectRange")]),e._v("的话，那么我们可以使用"),n("code",[e._v("getSelection")]),e._v("和"),n("code",[e._v("createRange")]),e._v("方法来模拟这个过程了，"),n("code",[e._v("Selection")]),e._v("对象表示用户选择的文本范围或光标的当前位置，满足执行execComman命令的可编辑活动区域，如下")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("let range = document.createRange()\nlet tar = document.querySelector('#code')\nrange.selectNodeContents(tar)\nlet selection = window.getSelection()\nselection.removeAllRanges()\nselection.addRange(range)\ndocument.execCommand('copy')\nselection.removeAllRanges()\n")])]),n("p",[e._v("上述针对非input，textarea等表单元素也能实现了")])])}],!1,null,null,null);t.default=a.exports}}]);